# -*- mode: sh; sh-shell: zsh;-*-
# Start the aria2 download manager using the default config
# and start a web client application with it.

local subcommand=$1

case $subcommand in
		(help|--help|-h)
				cat <<EOF
Available subcommands:

ui - Start the web browser client server, on port 8080
server - Start aria2
EOF
				;;
		(ui)
				local WEB_APP_PATH=$HOME/web_apps/webui-aria2

				[[ -d $WEB_APP_PATH ]] ||
						{mkdir -p $WEB_APP_PATH
						 git clone https://github.com/ziahamza/webui-aria2 $WEB_APP_PATH}

				while sleep 2
				do
						find $WEB_APP_PATH -type f -not -path '*/\.git*' | \
								entr -rd zsh \
										 -c "print 'Restarting Web UI';
ruby -run -e httpd $WEB_APP_PATH/ -p 8080"
				done
				;;
		(server)
				local ARIA_KEY=$(date +%s) ;\
				echo $ARIA_KEY > ~/temp/access.key ;\
				ls $HOME/.aria2/aria2.conf | \
						entr -r zsh \
								 -c "print 'Restarting Aria2'; aria2c --rpc-secret=$ARIA_KEY"
				;;
esac
